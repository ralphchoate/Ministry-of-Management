<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Manager Parable Coach ‚Äî Vanilla</title>
  <meta name="description" content="Draw short parables with morals, reflections, and actions to help managers think clearly." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Ccircle cx='64' cy='64' r='62' fill='%23000'/%3E%3Cpath d='M38 78c8 10 18 15 26 15 15 0 26-12 26-27 0-15-11-27-26-27-8 0-18 5-26 15V30h-8v68h8V78z' fill='%23fff'/%3E%3C/svg%3E" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; }
    body { background: linear-gradient(to bottom, #ffffff, #f9fafb); }
    .chip { padding: 0.25rem 0.75rem; border-radius: 1rem; border: 1px solid #d1d5db; font-size: 0.875rem; box-shadow: 0 1px 1px rgba(0,0,0,0.05); background: white; color: #374151; }
    .chip.active { background: rgba(0,0,0,0.9); color: white; border-color: black; }
    .btn { padding: 0.5rem 1rem; border-radius: 1rem; background: rgba(0,0,0,0.9); color: white; box-shadow: 0 1px 1px rgba(0,0,0,0.05); }
    .btn-outline { padding: 0.25rem 0.75rem; border-radius: 1rem; border: 1px solid #d1d5db; font-size: 0.875rem; }
    .card { background: white; border-radius: 1rem; padding: 1rem; box-shadow: 0 1px 1px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; }
    .note { font-size: 0.75rem; color: #6b7280; line-height: 1.2; }
  </style>
</head>
<body>
  <div class="min-h-dvh w-full text-gray-900">
    <div class="max-w-5xl mx-auto p-6 md:p-10">
      <header class="mb-6 md:mb-10">
        <h1 class="text-2xl md:text-4xl font-semibold tracking-tight">Manager Parable Coach</h1>
        <p class="text-gray-600 mt-2 max-w-2xl">
          Give me a challenge. I‚Äôll return a short parable, a moral, three reflection prompts, and three next steps‚Äî
          practical, memorable, and just a bit mischievous.
        </p>
      </header>

      <section class="grid md:grid-cols-3 gap-4 md:gap-6 mb-6">
        <div class="md:col-span-2 card">
          <label class="text-sm font-medium">Describe your challenge</label>
          <textarea id="challenge" class="mt-2 w-full h-28 rounded-xl border border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-black/10"
            placeholder="E.g., We‚Äôre drowning in half-done projects and stakeholders want everything yesterday."></textarea>

          <div class="mt-4">
            <label class="text-sm font-medium">Tags (optional)</label>
            <div id="tagPicker" class="mt-2 flex flex-wrap gap-2"></div>
            <p id="detected" class="note"></p>
          </div>

          <div class="mt-4 flex flex-wrap gap-4 items-center">
            <div>
              <label class="text-sm font-medium">Tone</label>
              <div id="toneSelect" class="mt-2 flex gap-2 items-center"></div>
            </div>
            <div>
              <label class="text-sm font-medium">Length</label>
              <div id="lengthToggle" class="mt-2 inline-flex rounded-2xl border border-gray-300 overflow-hidden shadow-sm"></div>
            </div>
            <div class="ml-auto flex gap-2 items-end">
              <button id="drawBtn" class="btn">Draw a Parable</button>
              <button id="copyBtn" class="btn-outline hidden">Copy</button>
            </div>
          </div>

          <p class="note mt-2">
            Not for legal, HR, or safety emergencies. For harassment, discrimination, or legal issues, involve HR/Legal.
          </p>
        </div>

        <div class="card flex flex-col">
          <h3 class="font-medium mb-2">Session</h3>
          <div id="chat" class="flex-1 overflow-y-auto pr-1 space-y-3" style="max-height: 420px;">
            <p class="note">Your conversation will appear here. Try a challenge like ‚ÄúWe have too many priorities and quality is slipping.‚Äù</p>
          </div>
          <div class="mt-3 flex gap-2">
            <button id="angleBtn" class="btn-outline" disabled>Another angle</button>
            <button id="copyBtn2" class="btn-outline hidden">Copy</button>
          </div>
        </div>
      </section>

      <section id="result" class="card hidden"></section>

      <footer class="mt-8 text-sm text-gray-500">
        Built as an MVP. Want a Slack/Teams version, analytics, or your org‚Äôs stories baked in? Drop a line.
      </footer>
    </div>
  </div>

  <script>
    // DATA ------------------------------
    const TAGS = [
      "Alignment","Communication","Prioritization","Delegation","Decision-Making","Change","Crisis","Stakeholders",
      "Innovation","Constraints","Quality","Technical Debt","Process/Flow","Feedback","Performance","Burnout",
      "Roadmapping","Compliance/Audit","Data & Metrics","Vendor Mgmt"
    ];

    const PARABLES = [
      { id:"lighthouse-fleet", title:"The Lighthouse and the Fleet", tags:["Alignment"], short:"When intent is clear, autonomy steers.", full:"A longer version...", moral:"Broadcast intent.", reflections:["What intent?","Where over-spec?","Who needs autonomy?"], actions:["Draft intent.","Replace a checklist.","Run captain's roundtable."], angles:["Outcome > Output"] }
    ];

    const TONE_WRAPPERS = {
      "sage": { pre: "Here‚Äôs a story to carry in your pocket:", post: "May this nudge your judgment more than your to-do list." },
      "playful": { pre: "Story mode: on. ‚òïüêô", post: "Now go make a little mischief‚Äîin a good way." },
      "practical": { pre: "Try this quick parable, then the checklist:", post: "Translate one line into action before the next meeting." },
      "tough-love": { pre: "No sugar coating‚Äîjust a clean mirror:", post: "Choose the move that shrinks risk fastest." },
    };

    const KEYWORD_TAG_MAP = {
      align:["Alignment"], strategy:["Decision-Making"], decide:["Decision-Making"], stakeholder:["Stakeholders"],
      communicate:["Communication"], message:["Communication"], priority:["Prioritization"], backlog:["Prioritization","Process/Flow"],
      wip:["Prioritization","Process/Flow"], flow:["Process/Flow"], bottleneck:["Process/Flow"], block:["Risk","Process/Flow"],
      risk:["Risk"], delegate:["Delegation"], overload:["Burnout"], burnout:["Burnout"], audit:["Compliance/Audit"],
      compliance:["Compliance/Audit"], data:["Data & Metrics"], metric:["Data & Metrics"], vendor:["Vendor Mgmt"],
      contract:["Vendor Mgmt"], quality:["Quality"], debt:["Technical Debt"], change:["Change"], crisis:["Crisis"],
      roadmap:["Roadmapping"], deadline:["Roadmapping","Prioritization"], feedback:["Feedback"], perform:["Performance"],
      succession:["Delegation"], keys:["Delegation"], team:["Alignment"], PERM:["Compliance/Audit"], OPR:["Compliance/Audit"],
      RAC:["Compliance/Audit"], eligibility:["Process/Flow"],
    };

    // STATE ------------------------------
    let selectedTags = ["Alignment","Prioritization"];
    let tone = "practical";
    let length = "short";
    let lastParable = null;

    // HELPERS ------------------------------
    const byId = (id) => document.getElementById(id);

    function classNames(...xs){ return xs.filter(Boolean).join(" "); }

    function extractTextTags(text){
      const words = text.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/);
      const found = new Set();
      for(const w of words){ if(KEYWORD_TAG_MAP[w]) KEYWORD_TAG_MAP[w].forEach(t=>found.add(t)); }
      return Array.from(found);
    }

    function scoreParable(p, selectedTags, textTags){
      const tagSet = new Set([...selectedTags, ...textTags]);
      let score = 0;
      p.tags.forEach(t=>{ if(tagSet.has(t)) score += 2; });
      score += Math.min(2, p.tags.filter(t=>tagSet.has(t)).length);
      return score;
    }

    function pickParable(parables, selectedTags, textTags){
      const scored = parables.map(p=>({p, s: scoreParable(p, selectedTags, textTags)})).sort((a,b)=>b.s-a.s);
      const topScore = scored[0]?.s ?? 0;
      const top = scored.filter(x=>x.s===topScore).map(x=>x.p);
      return top[Math.floor(Math.random() * top.length)] || parables[0];
    }

    function copyToClipboard(text){
      if (navigator.clipboard && window.isSecureContext){
        return navigator.clipboard.writeText(text);
      } else {
        const ta = document.createElement("textarea");
        ta.value = text; ta.style.position="fixed"; ta.style.left="-9999px";
        document.body.appendChild(ta); ta.focus(); ta.select();
        document.execCommand("copy"); document.body.removeChild(ta);
        return Promise.resolve();
      }
    }

    function chip(label, active, onClick){
      const btn = document.createElement("button");
      btn.type = "button"; btn.textContent = label;
      btn.className = "chip" + (active ? " active" : "");
      btn.addEventListener("click", onClick);
      return btn;
    }

    // UI INIT ------------------------------
    function renderTags(){
      const holder = byId("tagPicker");
      holder.innerHTML = "";
      TAGS.forEach(t => {
        holder.appendChild(chip(t, selectedTags.includes(t), () => {
          if(selectedTags.includes(t)) selectedTags = selectedTags.filter(x=>x!==t);
          else selectedTags = [...selectedTags, t];
          renderTags();
        }));
      });
    }

    function renderTone(){
      const holder = byId("toneSelect");
      holder.innerHTML = "";
      ["practical","sage","playful","tough-love"].forEach(t => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = t.replace("-"," ");
        btn.className = classNames("px-3 py-1 rounded-2xl border text-sm shadow-sm capitalize",
          tone===t ? "bg-black/90 text-white border-black" : "bg-white text-gray-700 border-gray-300 hover:border-gray-400");
        btn.addEventListener("click", ()=>{ tone = t; renderTone(); });
        holder.appendChild(btn);
      });
    }

    function renderLength(){
      const holder = byId("lengthToggle");
      holder.innerHTML = "";
      ["short","full"].forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt==="short" ? "Bite-size" : "Full";
        btn.className = classNames("px-3 py-1 text-sm", length===opt ? "bg-black/90 text-white" : "bg-white text-gray-700");
        btn.addEventListener("click", ()=>{ length = opt; renderLength(); });
        holder.appendChild(btn);
      });
    }

    function addChat(role, content){
      const chat = byId("chat");
      const box = document.createElement("div");
      box.className = classNames("rounded-2xl p-3 border shadow-sm", role==="user" ? "bg-gray-50 border-gray-200" : "bg-amber-50 border-amber-200");
      const label = document.createElement("div");
      label.className = "text-xs uppercase tracking-wide text-gray-500 mb-1";
      label.textContent = role==="user" ? "You" : "Coach";
      const text = document.createElement("div");
      text.className = "whitespace-pre-wrap leading-relaxed text-[15px]";
      text.textContent = content;
      box.appendChild(label); box.appendChild(text);
      if(chat.firstElementChild && chat.firstElementChild.classList.contains("note")) chat.innerHTML="";
      chat.appendChild(box);
      chat.scrollTo({ top: chat.scrollHeight, behavior: "smooth" });
    }

    function renderResult(p){
      const section = byId("result");
      section.innerHTML = "";
      const title = document.createElement("h2");
      title.className = "text-xl font-semibold";
      title.textContent = p.title;
      const body = document.createElement("p");
      body.className = "mt-2 text-gray-700 whitespace-pre-wrap";
      body.textContent = (length==="short" ? p.short : p.full);
      const moral = document.createElement("div");
      moral.className = "mt-3 font-medium";
      moral.innerHTML = 'Moral: <span class="font-normal"></span>';
      moral.querySelector("span").textContent = p.moral;

      const grid = document.createElement("div");
      grid.className = "mt-4 grid md:grid-cols-2 gap-4";

      const reflect = document.createElement("div");
      const rH = document.createElement("h4"); rH.className="font-medium"; rH.textContent="Reflect";
      const rUl = document.createElement("ul"); rUl.className="list-disc ml-5 mt-2 space-y-1 text-gray-700";
      p.reflections.forEach(q=>{ const li=document.createElement("li"); li.textContent=q; rUl.appendChild(li); });
      reflect.appendChild(rH); reflect.appendChild(rUl);

      const act = document.createElement("div");
      const aH = document.createElement("h4"); aH.className="font-medium"; aH.textContent="Try";
      const aUl = document.createElement("ul"); aUl.className="list-disc ml-5 mt-2 space-y-1 text-gray-700";
      p.actions.forEach(a=>{ const li=document.createElement("li"); li.textContent=a; aUl.appendChild(li); });
      act.appendChild(aH); act.appendChild(aUl);

      grid.appendChild(reflect); grid.appendChild(act);

      const btnRow = document.createElement("div");
      btnRow.className = "mt-4 flex gap-2";
      const copy = document.createElement("button");
      copy.className = "btn-outline"; copy.textContent = "Copy";
      copy.addEventListener("click", ()=> copyToClipboard(coachCardText(p)));
      const angle = document.createElement("button");
      angle.className = "btn-outline"; angle.textContent = "Another angle";
      angle.addEventListener("click", ()=> addAltAngle());
      btnRow.appendChild(copy); btnRow.appendChild(angle);

      section.appendChild(title); section.appendChild(body); section.appendChild(moral); section.appendChild(grid); section.appendChild(btnRow);
      section.classList.remove("hidden");
    }

    function coachCardText(p){
      return `${p.title}

${length==="short" ? p.short : p.full}

Moral: ${p.moral}

Reflection Questions:
- ${p.reflections.join("
- ")}

Actions:
- ${p.actions.join("
- ")}`;
    }

    // ACTIONS ------------------------------
    function draw(){
      const challenge = byId("challenge").value.trim();
      const textTags = extractTextTags(challenge);
      byId("detected").textContent = textTags.length ? `I also detected: ${textTags.join(", ")}` : "";

      const p = pickParable(PARABLES, selectedTags, textTags);
      lastParable = p;

      const w = TONE_WRAPPERS[tone];
      const story = `${w.pre}

${length==="short" ? p.short : p.full}

‚Äî Moral: ${p.moral}

Reflect:
‚Ä¢ ${p.reflections[0]}
‚Ä¢ ${p.reflections[1]}
‚Ä¢ ${p.reflections[2]}

Try:
‚Ä¢ ${p.actions[0]}
‚Ä¢ ${p.actions[1]}
‚Ä¢ ${p.actions[2]}

${w.post}`;

      addChat("user", challenge || selectedTags.join(", "));
      addChat("coach", story);
      renderResult(p);

      byId("copyBtn").classList.remove("hidden");
      byId("copyBtn2").classList.remove("hidden");
      byId("angleBtn").disabled = false;
    }

    function addAltAngle(){
      if(!lastParable) return;
      const angles = lastParable.angles || [];
      const angle = angles[Math.floor(Math.random() * (angles.length || 1))] || "Shift focus to the simplest actionable move.";
      addChat("coach", `Another angle on ‚Äú${lastParable.title}‚Äù: ${angle}`);
    }

    function init(){
      // tags
      renderTags();
      // tone
      renderTone();
      // length
      renderLength();
      // buttons
      byId("drawBtn").addEventListener("click", draw);
      byId("angleBtn").addEventListener("click", addAltAngle);
      const copyAll = ()=> {
        if(!lastParable) return;
        copyToClipboard(coachCardText(lastParable));
      };
      byId("copyBtn").addEventListener("click", copyAll);
      byId("copyBtn2").addEventListener("click", copyAll);
    }

    window.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
